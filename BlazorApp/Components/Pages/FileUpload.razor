@page "/upload"
@using Amazon.S3
@inject IAmazonS3 S3Client
@inject IConfiguration Configuration
@rendermode InteractiveServer
<h3>File Upload to S3</h3>

<InputFile type="file" @onchange="OnFileSelected" />
<button @onclick="UploadFile" disabled="@isUploading">Upload</button>
<h1>Counter</h1>

<p role="status">Current count: @currentCount</p>

<button class="btn btn-primary" @onclick="IncrementCount">Click me</button>
@code {
    private int currentCount = 0;

    private void IncrementCount()
    {
        currentCount++;
    }
    private bool isUploading = false;
    private IBrowserFile selectedFile;

    // Corrected method to handle file selection
    private void OnFileSelected(InputFileChangeEventArgs e)
    {
        // This is the correct way to extract files from the file input
        var file = (IEnumerable<IBrowserFile>)e.File;
        selectedFile = file?.First(); // Get the first file selected
    }

    private async Task UploadFile()
    {
        if (selectedFile != null)
        {
            isUploading = true;
            Thread.Sleep(1000);
            // try
            // {
            //     var bucketName = Configuration["AWS:S3:BucketName"]; // Configure your bucket name in appsettings.json or environment
            //     var keyName = selectedFile.FileName;  // Use the file's name as the key or you can generate a unique name

            //     // Convert the file to a stream to upload
            //     using (var fileStream = selectedFile.OpenReadStream())
            //     {
            //         // Create the S3 upload request
            //         var uploadRequest = new Amazon.S3.Model.PutObjectRequest
            //             {
            //                 BucketName = bucketName,
            //                 Key = keyName,
            //                 InputStream = fileStream,
            //                 ContentType = selectedFile.ContentType
            //             };

            //         // Upload the file to S3
            //         var response = await S3Client.PutObjectAsync(uploadRequest);

            //         if (response.HttpStatusCode == System.Net.HttpStatusCode.OK)
            //         {
            //             // Handle success
            //             Console.WriteLine($"File uploaded successfully to S3: {keyName}");
            //         }
            //         else
            //         {
            //             // Handle failure
            //             Console.WriteLine($"Error uploading file: {response.HttpStatusCode}");
            //         }
            //     }
            // }
            // catch (Exception ex)
            // {
            //     // Handle exception
            //     Console.WriteLine($"Error: {ex.Message}");
            // }

            isUploading = false;
        }
    }
}
